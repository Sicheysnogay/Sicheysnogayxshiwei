-- shiwei-v1.2_obf.lua
-- Base64-only obfuscated loader (no key). Decodes payload and executes.
local b64 = [[LS0gc2hpd2VpLXYxLjIubHVhCi0tIFNoaSBXZWkgWCBTaWNoZXlzIC0gdjEuMiAtCi0tIEZlYXR1cmVzOiBncmFwaGljcyBzY2FsZSwgRlBTIGRpc3BsYXksIGZvZyB0b2dnbGUsIHZpc3VhbCBib29zdCAoYmxvb20vY2MpLCBzZXJ2ZXIgdG9vbHMKCmxvY2FsIFJheWZpZWxkID0gbG9hZHN0cmluZyhnYW1lOkh0dHBHZXQoJ2h0dHBzOi8vc2lyaXVzLm1lbnUvcmF5ZmllbGQnKSkoKQoKbG9jYWwgV2luZG93ID0gUmF5ZmllbGQ6Q3JlYXRlV2luZG93KHsKICAgIE5hbWUgPSAiU2hpIFdlaSBYIFNpY2hleXMgLSB2MS4yIC0iLAogICAgTG9hZGluZ1RpdGxlID0gIlNoaSBXZWkgSHViIiwKICAgIExvYWRpbmdTdWJ0aXRsZSA9ICJieSBzaGkgd2VpIiwKICAgIENvbmZpZ3VyYXRpb25TYXZpbmcgPSB7CiAgICAgICBFbmFibGVkID0gdHJ1ZSwKICAgICAgIEZvbGRlck5hbWUgPSAiU2hpd2VpSHViIiwKICAgICAgIEZpbGVOYW1lID0gInNoaXdlaS12MS4yIgogICAgfQp9KQoKLS0gVGFicwpsb2NhbCBIb21lVGFiID0gV2luZG93OkNyZWF0ZVRhYigiSG9tZSIsIDQ0ODMzNjI0NTgpCmxvY2FsIEdyYXBoaWNzVGFiID0gV2luZG93OkNyZWF0ZVRhYigiR3JhcGhpY3MiLCA0NDgzMzYyNDU4KQpsb2NhbCBGUFNfVGFiID0gV2luZG93OkNyZWF0ZVRhYigiRlBTIiwgNDQ4MzM2MjQ1OCkKbG9jYWwgU2VydmVyVGFiID0gV2luZG93OkNyZWF0ZVRhYigiU2VydmVyIiwgNDQ4MzM2MjQ1OCkKbG9jYWwgU2V0dGluZ3NUYWIgPSBXaW5kb3c6Q3JlYXRlVGFiKCJTZXR0aW5ncyIsIDQ0ODMzNjI0NTgpCgotLSBMaW5rcwpIb21lVGFiOkNyZWF0ZVBhcmFncmFwaCh7VGl0bGU9IkF1dGhvciIsIENvbnRlbnQ9InNoaSB3ZWkifSkKSG9tZVRhYjpDcmVhdGVCdXR0b24oe05hbWU9IkRpc2NvcmQgSW52aXRlIiwgQ2FsbGJhY2s9ZnVuY3Rpb24oKQogICAgaWYgc2V0Y2xpcGJvYXJkIHRoZW4gcGNhbGwoc2V0Y2xpcGJvYXJkLCAiaHR0cHM6Ly9kaXNjb3JkLmdnL1ZSVWVxS2ZEcTIiKSBlbmQKICAgIFJheWZpZWxkOk5vdGlmeSh7VGl0bGU9IkNvcGllZCIsIENvbnRlbnQ9IkRpc2NvcmQgbGluayDEkcOjIGNvcHkhIiwgRHVyYXRpb249M30pCmVuZH0pCkhvbWVUYWI6Q3JlYXRlQnV0dG9uKHtOYW1lPSJGYWNlYm9vayBMaW5rIiwgQ2FsbGJhY2s9ZnVuY3Rpb24oKQogICAgaWYgc2V0Y2xpcGJvYXJkIHRoZW4gcGNhbGwoc2V0Y2xpcGJvYXJkLCAiaHR0cHM6Ly93d3cuZmFjZWJvb2suY29tL3NoYXJlLzFKQlFONzlOdlAvIikgZW5kCiAgICBSYXlmaWVsZDpOb3RpZnkoe1RpdGxlPSJDb3BpZWQiLCBDb250ZW50PSJGYWNlYm9vayBsaW5rIMSRw6MgY29weSEiLCBEdXJhdGlvbj0zfSkKZW5kfSkKCi0tIEdyYXBoaWNzIGNvbnRyb2xzIChzY2FsZSAyMCUuLjkwJSkKLS0gV2UnbGwgbWFwIHNjYWxlIHRvIHNvbWUgTGlnaHRpbmcgKyBQb3N0RWZmZWN0IGFkanVzdG1lbnRzCmxvY2FsIExpZ2h0aW5nID0gZ2FtZTpHZXRTZXJ2aWNlKCJMaWdodGluZyIpCmxvY2FsIFJ1blNlcnZpY2UgPSBnYW1lOkdldFNlcnZpY2UoIlJ1blNlcnZpY2UiKQpsb2NhbCBTdGFydGVyR3VpID0gZ2FtZTpHZXRTZXJ2aWNlKCJTdGFydGVyR3VpIikKCi0tIEVuc3VyZSBCbG9vbSBhbmQgQ29sb3JDb3JyZWN0aW9uIGV4aXN0CmxvY2FsIGZ1bmN0aW9uIGdldE9yQ3JlYXRlUG9zdEVmZmVjdChjbGFzc05hbWUsIG5hbWUpCiAgICBsb2NhbCBmb3VuZCA9IExpZ2h0aW5nOkZpbmRGaXJzdENoaWxkKG5hbWUpCiAgICBpZiBmb3VuZCBhbmQgZm91bmQuQ2xhc3NOYW1lID09IGNsYXNzTmFtZSB0aGVuIHJldHVybiBmb3VuZCBlbmQKICAgIGxvY2FsIG9iaiA9IEluc3RhbmNlLm5ldyhjbGFzc05hbWUpCiAgICBvYmouTmFtZSA9IG5hbWUKICAgIG9iai5QYXJlbnQgPSBMaWdodGluZwogICAgcmV0dXJuIG9iagplbmQKbG9jYWwgQmxvb20gPSBnZXRPckNyZWF0ZVBvc3RFZmZlY3QoIkJsb29tRWZmZWN0IiwgIlNoaXdlaV9CbG9vbSIpCmxvY2FsIENDID0gZ2V0T3JDcmVhdGVQb3N0RWZmZWN0KCJDb2xvckNvcnJlY3Rpb24iLCAiU2hpd2VpX0NvbG9yIikKbG9jYWwgQmx1ciA9IGdldE9yQ3JlYXRlUG9zdEVmZmVjdCgiQmx1ckVmZmVjdCIsICJTaGl3ZWlfQmx1ciIpCgotLSBTdG9yZSBvcmlnaW5hbCB2YWx1ZXMgdG8gcmVzdG9yZQpsb2NhbCBvcmlnaW5hbCA9IHsKICAgIEJsb29tID0gQmxvb20uSW50ZW5zaXR5LAogICAgQnJpZ2h0bmVzcyA9IExpZ2h0aW5nLkJyaWdodG5lc3MsCiAgICBPdXRkb29yQW1iaWVudCA9IExpZ2h0aW5nLk91dGRvb3JBbWJpZW50LAogICAgRm9nU3RhcnQgPSBMaWdodGluZy5Gb2dTdGFydCwKICAgIEZvZ0VuZCA9IExpZ2h0aW5nLkZvZ0VuZCwKICAgIENDX0NvbnRyYXN0ID0gQ0MuQ29udHJhc3QsCiAgICBDQ19TYXR1cmF0aW9uID0gQ0MuU2F0dXJhdGlvbiwKICAgIEJsdXJfU2l6ZSA9IEJsdXIuU2l6ZQp9CgotLSBBcHBseSBncmFwaGljcyBzY2FsZSAoMjAuLjkwKQpsb2NhbCBmdW5jdGlvbiBhcHBseUdyYXBoaWNzU2NhbGUocGN0KQogICAgcGN0ID0gbWF0aC5jbGFtcChwY3QsIDIwLCA5MCkKICAgIGxvY2FsIHQgPSAocGN0IC0gMjApIC8gKDkwIC0gMjApIC0tIDAuLjEKICAgIC0tIGFkanVzdCBCbG9vbSBpbnRlbnNpdHkgMC4yLi4yLjAKICAgIEJsb29tLkludGVuc2l0eSA9IDAuMiArIHQgKiAoMi4wIC0gMC4yKQogICAgLS0gYnJpZ2h0bmVzcyAxLi4zCiAgICBMaWdodGluZy5CcmlnaHRuZXNzID0gMSArIHQgKiAyCiAgICBMaWdodGluZy5PdXRkb29yQW1iaWVudCA9IENvbG9yMy5mcm9tSFNWKDAuNTgsIDAuMiArIHQqMC41LCAwLjYgKyB0KjAuNCkKICAgIC0tIHN1YnRsZSBibHVyIGZvciBsb3dlciBxdWFsaXR5IC0+IHJlZHVjZSBibHVyIHdoZW4gcXVhbGl0eSBoaWdoCiAgICBCbHVyLlNpemUgPSA2ICogKDEgLSB0KQogICAgLS0gY29sb3IgY29ycmVjdGlvbiBjb250cmFzdC9zYXR1cmF0aW9uCiAgICBDQy5Db250cmFzdCA9IC0wLjEgKyB0ICogMC40CiAgICBDQy5TYXR1cmF0aW9uID0gLTAuMiArIHQgKiAwLjYKZW5kCgotLSBTbGlkZXIgY29udHJvbApHcmFwaGljc1RhYjpDcmVhdGVTbGlkZXIoewogICAgTmFtZSA9ICJHcmFwaGljcyBTY2FsZSAoMjAlIC0gOTAlKSIsCiAgICBSYW5nZSA9IHsyMCwgOTB9LAogICAgSW5jcmVtZW50ID0gNSwKICAgIFN1ZmZpeCA9ICIlIiwKICAgIEN1cnJlbnRWYWx1ZSA9IDYwLAogICAgRmxhZyA9ICJncmFwaGljc19zY2FsZSIsCiAgICBDYWxsYmFjayA9IGZ1bmN0aW9uKHZhbHVlKQogICAgICAgIGFwcGx5R3JhcGhpY3NTY2FsZSh2YWx1ZSkKICAgIGVuZAp9KQoKLS0gRm9nIHRvZ2dsZSAocmVtb3ZlIGZvZykKbG9jYWwgZm9nUmVtb3ZlZCA9IGZhbHNlCkdyYXBoaWNzVGFiOkNyZWF0ZVRvZ2dsZSh7CiAgICBOYW1lID0gIlJlbW92ZSBGb2ciLAogICAgQ3VycmVudFZhbHVlID0gZmFsc2UsCiAgICBDYWxsYmFjayA9IGZ1bmN0aW9uKHN0YXRlKQogICAgICAgIGZvZ1JlbW92ZWQgPSBzdGF0ZQogICAgICAgIGlmIHN0YXRlIHRoZW4KICAgICAgICAgICAgTGlnaHRpbmcuRm9nU3RhcnQgPSAxZTYKICAgICAgICAgICAgTGlnaHRpbmcuRm9nRW5kID0gMWU5CiAgICAgICAgZWxzZQogICAgICAgICAgICBMaWdodGluZy5Gb2dTdGFydCA9IG9yaWdpbmFsLkZvZ1N0YXJ0IG9yIDAKICAgICAgICAgICAgTGlnaHRpbmcuRm9nRW5kID0gb3JpZ2luYWwuRm9nRW5kIG9yIDEwMDAwMAogICAgICAgIGVuZAogICAgZW5kCn0pCgotLSBWaXN1YWwgYm9vc3QgKGFwcHJveGltYXRlICdSVFgtbGlrZScgbG9vayB1c2luZyBlZmZlY3RzKQpsb2NhbCBib29zdEVuYWJsZWQgPSBmYWxzZQpHcmFwaGljc1RhYjpDcmVhdGVUb2dnbGUoewogICAgTmFtZSA9ICJWaXN1YWwgQm9vc3QgKGJsb29tL2NjKSIsCiAgICBDdXJyZW50VmFsdWUgPSBmYWxzZSwKICAgIENhbGxiYWNrID0gZnVuY3Rpb24oc3RhdGUpCiAgICAgICAgYm9vc3RFbmFibGVkID0gc3RhdGUKICAgICAgICBpZiBzdGF0ZSB0aGVuCiAgICAgICAgICAgIEJsb29tLkludGVuc2l0eSA9IEJsb29tLkludGVuc2l0eSAqIDEuNgogICAgICAgICAgICBDQy5Db250cmFzdCA9IENDLkNvbnRyYXN0ICsgMC4xMgogICAgICAgICAgICBDQy5TYXR1cmF0aW9uID0gQ0MuU2F0dXJhdGlvbiArIDAuMQogICAgICAgIGVsc2UKICAgICAgICAgICAgQmxvb20uSW50ZW5zaXR5ID0gb3JpZ2luYWwuQmxvb20KICAgICAgICAgICAgQ0MuQ29udHJhc3QgPSBvcmlnaW5hbC5DQ19Db250cmFzdAogICAgICAgICAgICBDQy5TYXR1cmF0aW9uID0gb3JpZ2luYWwuQ0NfU2F0dXJhdGlvbgogICAgICAgIGVuZAogICAgZW5kCn0pCgotLSBGUFMgZGlzcGxheQpsb2NhbCBmcHNMYWJlbCA9IG5pbApsb2NhbCBzaG93RlBTID0gZmFsc2UKbG9jYWwgbGFzdFRpbWUgPSB0aWNrKCkKbG9jYWwgZnJhbWVDb3VudCA9IDAKbG9jYWwgZnBzQ29ubiA9IG5pbAoKbG9jYWwgZnVuY3Rpb24gY3JlYXRlRlBTTGFiZWwoKQogICAgaWYgZnBzTGFiZWwgYW5kIGZwc0xhYmVsLlBhcmVudCB0aGVuIHJldHVybiBmcHNMYWJlbCBlbmQKICAgIGxvY2FsIHNjcmVlbkd1aSA9IEluc3RhbmNlLm5ldygiU2NyZWVuR3VpIikKICAgIHNjcmVlbkd1aS5OYW1lID0gIlNoaXdlaUZQUyIKICAgIHNjcmVlbkd1aS5SZXNldE9uU3Bhd24gPSBmYWxzZQogICAgc2NyZWVuR3VpLlBhcmVudCA9IGdhbWU6R2V0U2VydmljZSgiQ29yZUd1aSIpCiAgICBmcHNMYWJlbCA9IEluc3RhbmNlLm5ldygiVGV4dExhYmVsIikKICAgIGZwc0xhYmVsLlNpemUgPSBVRGltMi5uZXcoMCwxMjAsMCwzMCkKICAgIGZwc0xhYmVsLlBvc2l0aW9uID0gVURpbTIubmV3KDAsMTAsMCwxMCkKICAgIGZwc0xhYmVsLkJhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAwLjUKICAgIGZwc0xhYmVsLkJhY2tncm91bmRDb2xvcjMgPSBDb2xvcjMubmV3KDAsMCwwKQogICAgZnBzTGFiZWwuVGV4dENvbG9yMyA9IENvbG9yMy5uZXcoMSwxLDEpCiAgICBmcHNMYWJlbC5UZXh0U2NhbGVkID0gdHJ1ZQogICAgZnBzTGFiZWwuRm9udCA9IEVudW0uRm9udC5Hb3RoYW0KICAgIGZwc0xhYmVsLlRleHQgPSAiRlBTOiAuLi4iCiAgICBmcHNMYWJlbC5QYXJlbnQgPSBzY3JlZW5HdWkKICAgIHJldHVybiBmcHNMYWJlbAplbmQKCmxvY2FsIGZ1bmN0aW9uIHN0YXJ0RlBTKCkKICAgIGlmIGZwc0Nvbm4gdGhlbiByZXR1cm4gZW5kCiAgICBjcmVhdGVGUFNMYWJlbCgpCiAgICBmcHNDb25uID0gUnVuU2VydmljZS5SZW5kZXJTdGVwcGVkOkNvbm5lY3QoZnVuY3Rpb24oZHQpCiAgICAgICAgZnJhbWVDb3VudCA9IGZyYW1lQ291bnQgKyAxCiAgICAgICAgbG9jYWwgbm93ID0gdGljaygpCiAgICAgICAgaWYgbm93IC0gbGFzdFRpbWUgPj0gMSB0aGVuCiAgICAgICAgICAgIGxvY2FsIGZwcyA9IG1hdGguZmxvb3IoZnJhbWVDb3VudCAvIChub3cgLSBsYXN0VGltZSkgKyAwLjUpCiAgICAgICAgICAgIGlmIGZwc0xhYmVsIHRoZW4gZnBzTGFiZWwuVGV4dCA9ICJGUFM6ICIuLnRvc3RyaW5nKGZwcykgZW5kCiAgICAgICAgICAgIGZyYW1lQ291bnQgPSAwCiAgICAgICAgICAgIGxhc3RUaW1lID0gbm93CiAgICAgICAgZW5kCiAgICBlbmQpCmVuZAoKbG9jYWwgZnVuY3Rpb24gc3RvcEZQUygpCiAgICBpZiBmcHNDb25uIHRoZW4gZnBzQ29ubjpEaXNjb25uZWN0KCk7IGZwc0Nvbm4gPSBuaWwgZW5kCiAgICBpZiBmcHNMYWJlbCB0aGVuIGZwc0xhYmVsOkRlc3Ryb3koKTsgZnBzTGFiZWwgPSBuaWwgZW5kCmVuZAoKRlBTX1RhYjpDcmVhdGVUb2dnbGUoewogICAgTmFtZSA9ICJTaG93IEZQUyIsCiAgICBDdXJyZW50VmFsdWUgPSBmYWxzZSwKICAgIENhbGxiYWNrID0gZnVuY3Rpb24oc3RhdGUpCiAgICAgICAgc2hvd0ZQUyA9IHN0YXRlCiAgICAgICAgaWYgc3RhdGUgdGhlbiBzdGFydEZQUygpIGVsc2Ugc3RvcEZQUygpIGVuZAogICAgZW5kCn0pCgotLSBTZXJ2ZXIgdG9vbHMKbG9jYWwgUGxheWVycyA9IGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpCmxvY2FsIFRlbGVwb3J0U2VydmljZSA9IGdhbWU6R2V0U2VydmljZSgiVGVsZXBvcnRTZXJ2aWNlIikKbG9jYWwgSHR0cFNlcnZpY2UgPSBnYW1lOkdldFNlcnZpY2UoIkh0dHBTZXJ2aWNlIikKbG9jYWwgTWFya2V0cGxhY2VTZXJ2aWNlID0gZ2FtZTpHZXRTZXJ2aWNlKCJNYXJrZXRwbGFjZVNlcnZpY2UiKQoKbG9jYWwgZnVuY3Rpb24gZ2V0UGxheWVyQ291bnQoKQogICAgcmV0dXJuICNQbGF5ZXJzOkdldFBsYXllcnMoKQplbmQKCmxvY2FsIHBsYXllcnNMYWJlbCA9IFNlcnZlclRhYjpDcmVhdGVMYWJlbCgiUGxheWVycyBpbiBzZXJ2ZXI6ICIgLi4gdG9zdHJpbmcoZ2V0UGxheWVyQ291bnQoKSkpCi0tIHVwZGF0ZSBwbGF5ZXJzIGNvdW50IGV2ZXJ5IDUgc2Vjb25kcwpzcGF3bihmdW5jdGlvbigpCiAgICB3aGlsZSB0cnVlIGRvCiAgICAgICAgcGNhbGwoZnVuY3Rpb24oKQogICAgICAgICAgICBwbGF5ZXJzTGFiZWw6U2V0KCJQbGF5ZXJzIGluIHNlcnZlcjogIiAuLiB0b3N0cmluZyhnZXRQbGF5ZXJDb3VudCgpKSkKICAgICAgICBlbmQpCiAgICAgICAgd2FpdCg1KQogICAgZW5kCmVuZCkKCi0tIFNob3cgY3VycmVudCBnYW1lJ3MgbmFtZSAoYmVzdCBlZmZvcnQpCmxvY2FsIG9rLCBpbmZvID0gcGNhbGwoZnVuY3Rpb24oKSByZXR1cm4gTWFya2V0cGxhY2VTZXJ2aWNlOkdldFByb2R1Y3RJbmZvKGdhbWUuUGxhY2VJZCkgZW5kKQppZiBvayBhbmQgaW5mbyBhbmQgaW5mby5OYW1lIHRoZW4KICAgIFNlcnZlclRhYjpDcmVhdGVMYWJlbCgiR2FtZTogIi4udG9zdHJpbmcoaW5mby5OYW1lKSkKZW5kCgotLSBSZWpvaW4gc2VydmVyClNlcnZlclRhYjpDcmVhdGVCdXR0b24oe05hbWUgPSAiUmVqb2luIFNlcnZlciIsIENhbGxiYWNrID0gZnVuY3Rpb24oKQogICAgVGVsZXBvcnRTZXJ2aWNlOlRlbGVwb3J0KGdhbWUuUGxhY2VJZCwgUGxheWVycy5Mb2NhbFBsYXllcikKZW5kfSkKCi0tIEpvaW4gcmFuZG9tIG90aGVyIHNlcnZlciB3aXRoIGxlc3MgcGxheWVycyAodXNlcyBSb2Jsb3ggc2VydmVycyBBUEkgaWYgZXhlY3V0b3Igc3VwcG9ydHMgaHR0cCkKU2VydmVyVGFiOkNyZWF0ZUJ1dHRvbih7TmFtZSA9ICJKb2luIExvdyBQb3AgU2VydmVyIiwgQ2FsbGJhY2sgPSBmdW5jdGlvbigpCiAgICBsb2NhbCBzdWNjZXNzID0gZmFsc2UKICAgIGxvY2FsIHBsYWNlSWQgPSB0b3N0cmluZyhnYW1lLlBsYWNlSWQpCiAgICBsb2NhbCByZXF1ZXN0RnVuYyA9IG5pbAogICAgaWYgc3luIGFuZCBzeW4ucmVxdWVzdCB0aGVuIHJlcXVlc3RGdW5jID0gc3luLnJlcXVlc3QKICAgIGVsc2VpZiBodHRwIGFuZCBodHRwLnJlcXVlc3QgdGhlbiByZXF1ZXN0RnVuYyA9IGh0dHAucmVxdWVzdAogICAgZWxzZWlmIHJlcXVlc3QgdGhlbiByZXF1ZXN0RnVuYyA9IHJlcXVlc3QgZW5kCiAgICBpZiByZXF1ZXN0RnVuYyB0aGVuCiAgICAgICAgbG9jYWwgY3Vyc29yID0gIiIKICAgICAgICByZXBlYXQKICAgICAgICAgICAgbG9jYWwgdXJsID0gImh0dHBzOi8vZ2FtZXMucm9ibG94LmNvbS92MS9nYW1lcy8iLi5wbGFjZUlkLi4iL3NlcnZlcnMvUHVibGljP2xpbWl0PTEwMCIuLihjdXJzb3Igfj0gIiIgYW5kICgiJmN1cnNvcj0iLi5jdXJzb3IpIG9yICIiKQogICAgICAgICAgICBsb2NhbCByZXMgPSBuaWwKICAgICAgICAgICAgcGNhbGwoZnVuY3Rpb24oKSByZXMgPSByZXF1ZXN0RnVuYyh7VXJsID0gdXJsLCBNZXRob2QgPSAiR0VUIn0pIGVuZCkKICAgICAgICAgICAgaWYgcmVzIGFuZCByZXMuQm9keSB0aGVuCiAgICAgICAgICAgICAgICBsb2NhbCBkYXRhID0gbmlsCiAgICAgICAgICAgICAgICBwY2FsbChmdW5jdGlvbigpIGRhdGEgPSBIdHRwU2VydmljZTpKU09ORGVjb2RlKHJlcy5Cb2R5KSBlbmQpCiAgICAgICAgICAgICAgICBpZiBkYXRhIGFuZCBkYXRhLmRhdGEgdGhlbgogICAgICAgICAgICAgICAgICAgIGZvciBfLCBzIGluIGlwYWlycyhkYXRhLmRhdGEpIGRvCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIHMucGxheWluZyBhbmQgcy5wbGF5aW5nIDwgKFBsYXllcnMuTWF4UGxheWVycyBvciAxMCkgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcGNhbGwoZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFRlbGVwb3J0U2VydmljZTpUZWxlcG9ydFRvUGxhY2VJbnN0YW5jZShnYW1lLlBsYWNlSWQsIHMuaWQsIFBsYXllcnMuTG9jYWxQbGF5ZXIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdWNjZXNzID0gdHJ1ZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgY3Vyc29yID0gZGF0YS5uZXh0UGFnZUN1cnNvciBvciAiIgogICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgZW5kCiAgICAgICAgdW50aWwgc3VjY2VzcyBvciBjdXJzb3IgPT0gIiIKICAgIGVuZAogICAgaWYgbm90IHN1Y2Nlc3MgdGhlbgogICAgICAgIFJheWZpZWxkOk5vdGlmeSh7VGl0bGU9IkluZm8iLCBDb250ZW50PSJLaMO0bmcgdGjhu4MgdMOsbSBzZXJ2ZXIgw610IG5nxrDhu51pIChob+G6t2MgSFRUUCBi4buLIGNo4bq3bikuIiwgRHVyYXRpb249NH0pCiAgICBlbmQKZW5kfSkKCi0tIFNhZmV0eTogYXBwbHkgZGVmYXVsdCBncmFwaGljcyBzY2FsZSBhdCBsb2FkCmFwcGx5R3JhcGhpY3NTY2FsZSg2MCkKClJheWZpZWxkOk5vdGlmeSh7VGl0bGU9IlNoaXdlaSIsIENvbnRlbnQ9IkxvYWRlZCB2MS4yIiwgRHVyYXRpb249M30pCgotLSBFbmQgb2YgZmlsZQo=]]

local function b64dec(data)
    local b='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/'
    data = string.gsub(data, '[^'..b..'=]', '')
    return (data:gsub('.', function(x)
        if (x == '=') then return '' end
        local r,f='',0
        for i=1,64 do if string.sub(b,i,i) == x then f = i-1; break end end
        local bin = ''
        for i=6,1,-1 do
            bin = bin .. (math.floor(f / 2^(i-1)) % 2)
        end
        return bin
    end):gsub('%d%d%d%d%d%d%d%d', function(x)
        local c=0
        for i=1,8 do c = c + (tonumber(string.sub(x,i,i)) * 2^(8-i)) end
        return string.char(c)
    end))
end

local ok, decoded = pcall(b64dec, b64)
if not ok or type(decoded) ~= 'string' then
    error('Failed to decode payload')
end

local f, err = loadstring(decoded)
if not f then
    error('Loadstring error: '..tostring(err))
end
pcall(f)
